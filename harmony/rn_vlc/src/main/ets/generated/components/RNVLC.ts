/**
 * This code was generated by "react-native codegen-lib-harmony"
 */

import {
  Descriptor as ComponentDescriptor,
  ViewBaseProps,
  ViewRawProps,
  ViewDescriptorWrapperBase,
  ColorValue,
  Color,
  RNInstance,
  Tag,
  RNComponentCommandReceiver,
  ViewPropsSelector,
} from '@rnoh/react-native-openharmony/ts';


export namespace RNVLC {
  export const NAME = "RNVLC" as const

  export interface DirectRawProps {
    source?: {uri?: string, initType?: number, initOptions?: string[]};
    subtitleUri?: string;
    paused?: boolean;
    repeat?: boolean;
    rate?: number;
    seek?: number;
    volume?: number;
    muted?: boolean;
    autoplay?: boolean;
    audioTrack?: number;
    textTrack?: number;
    playInBackground?: boolean;
    videoAspectRatio?: string;
    autoAspectRatio?: boolean;
    resizeMode?: string;
    progressUpdateInterval?: number;
    acceptInvalidCertificates?: boolean;
  }
  
  export interface Props extends ViewBaseProps {}
  
  export interface State {}
  
  export interface RawProps extends ViewRawProps, DirectRawProps {}
  
  export class PropsSelector extends ViewPropsSelector<Props, RawProps> {
    get source() {
      return this.rawProps.source;
    }
    
    get subtitleUri() {
      return this.rawProps.subtitleUri;
    }
    
    get paused() {
      return this.rawProps.paused ?? false;
    }
    
    get repeat() {
      return this.rawProps.repeat ?? false;
    }
    
    get rate() {
      return this.rawProps.rate ?? 1;
    }
    
    get seek() {
      return this.rawProps.seek ?? 0;
    }
    
    get volume() {
      return this.rawProps.volume ?? 0;
    }
    
    get muted() {
      return this.rawProps.muted ?? false;
    }
    
    get autoplay() {
      return this.rawProps.autoplay ?? true;
    }
    
    get audioTrack() {
      return this.rawProps.audioTrack ?? 0;
    }
    
    get textTrack() {
      return this.rawProps.textTrack ?? 0;
    }
    
    get playInBackground() {
      return this.rawProps.playInBackground ?? false;
    }
    
    get videoAspectRatio() {
      return this.rawProps.videoAspectRatio;
    }
    
    get autoAspectRatio() {
      return this.rawProps.autoAspectRatio ?? false;
    }
    
    get resizeMode() {
      return this.rawProps.resizeMode;
    }
    
    get progressUpdateInterval() {
      return this.rawProps.progressUpdateInterval ?? 0;
    }
    
    get acceptInvalidCertificates() {
      return this.rawProps.acceptInvalidCertificates ?? false;
    }
    
  
  }

  export type Descriptor = ComponentDescriptor<
    typeof NAME,
    Props,
    State,
    RawProps
  >;
  
  export class DescriptorWrapper extends ViewDescriptorWrapperBase<
    typeof NAME,
    Props,
    State,
    RawProps,
    PropsSelector
  > {
    protected createPropsSelector() {
      return new PropsSelector(this.descriptor.props, this.descriptor.rawProps)
    }
  }
  
  export interface EventPayloadByName {
    "playing": {target?: number, duration?: number, seekable?: boolean}
    "progress": {target?: number, duration?: number, currentTime?: number, position?: number, remainingTime?: number}
    "paused": {target?: number}
    "stopped": {target?: number}
    "buffering": {target?: number}
    "end": {target?: number}
    "error": {target?: number}
    "load": {target?: number, duration?: number, videoSize?: {width?: number, height?: number}, audioTracks?: {id: number, name: string}[], textTracksJson?: {id: number, name: string}[]}
    "recordingCreated": {path?: string}
    "snapshot": {path?: string, success?: boolean, error?: string}
    "open": {target?: number}
  }
  
  export class EventEmitter {
    constructor(private rnInstance: RNInstance, private tag: Tag) {}
    
    emit<TEventName extends keyof EventPayloadByName>(eventName: TEventName, payload: EventPayloadByName[TEventName]) {
      this.rnInstance.emitComponentEvent(this.tag, eventName, payload)
    }
  }
  
  export interface CommandArgvByName {
    "resume": []
    "snapshot": [string]
    "seek": [number]
    "startRecording": [string]
    "stopRecording": []
    "autoAspectRatio": [boolean]
    "changeVideoAspectRatio": [string]
    "stopPlayer": []
  }
  
  export class CommandReceiver {
    private listenersByCommandName = new Map<string, Set<(...args: any[]) => void>>()
    private cleanUp: (() => void) | undefined = undefined
  
    constructor(private componentCommandReceiver: RNComponentCommandReceiver, private tag: Tag) {
    }
  
    subscribe<TCommandName extends keyof CommandArgvByName>(commandName: TCommandName, listener: (argv: CommandArgvByName[TCommandName]) => void) {
      if (!this.listenersByCommandName.has(commandName)) {
        this.listenersByCommandName.set(commandName, new Set())
      }
      this.listenersByCommandName.get(commandName)!.add(listener)
      const hasRegisteredCommandReceiver = !!this.cleanUp
      if (!hasRegisteredCommandReceiver) {
        this.cleanUp = this.componentCommandReceiver.registerCommandCallback(this.tag, (commandName: string, argv: any[]) => {
          if (this.listenersByCommandName.has(commandName)) {
            const listeners = this.listenersByCommandName.get(commandName)!
            listeners.forEach(listener => {
              listener(argv)
            })
          }
        })
      }
  
      return () => {
        this.listenersByCommandName.get(commandName)?.delete(listener)
        if (this.listenersByCommandName.get(commandName)?.size ?? 0 === 0) {
          this.listenersByCommandName.delete(commandName)
        }
        if (this.listenersByCommandName.size === 0) {
          this.cleanUp?.()
        }
      }
    }
  }

}
